请求地址： 

 /kapis/notification.kubesphere.io/v2beta2/verify

 /kapis/notification.kubesphere.io/v2beta2/users/{user}/verify

请求方法：POST

请求参数

| 字段     | 说明                                    | 类型             | 备注 |
| -------- | --------------------------------------- | ---------------- | ---- |
| config   | NotificationManager中的Config配置字段   | v2beta2.Config   |      |
| receiver | NotificationManager中的Receiver配置字段 | v2beta2.Receiver |      |

### Config

格式：

```go
"config":{
    "apiVersion":"notification.kubesphere.io/v2beta2",
    "kind":"Config",
    "metadata":{
      "name":"xxx",
      "labels":{
        "app":"notification-manager",
        "type":"tenant",
        "user":"xxx"
      }
    },
    "spec":{
      "dingtalk"
      "email"
      "slack"
      "webhook"
      "wechat"
      "sms"
      "pushover"
    }
  },
```

| 字段       | 说明             | 类型       | 备注                                                         |
| ---------- | ---------------- | ---------- | ------------------------------------------------------------ |
| apiVersion |                  |            | notification.kubesphere.io/v2beta2                           |
| kind       |                  |            | Config                                                       |
| metadata   | Config的元数据， |            | 包含name，labels等数据                                       |
| spec       | config的spec字段 | ConfigSpec | 包含七种，dingtalk，email,slack，webhook，wechat，sms，pushover |

##### dingtalk字段   类型：DingTalkConfig 

| 字段         | 说明                    | 类型                      | 备注                                       |
| ------------ | ----------------------- | ------------------------- | ------------------------------------------ |
| labels       | 钉钉labels              | map[string]string         | omitempty                                  |
| conversation | 发送alert到对话时才需要 | DingTalkApplicationConfig | 包含appkey以及appsecret两字段（omitempty） |

##### email字段   类型：EmailConfig  

| 字段         | 说明                                | 类型              | 备注                                                         |
| ------------ | ----------------------------------- | ----------------- | ------------------------------------------------------------ |
| labels       | email labels                        | map[string]string | omitempty                                                    |
| from         | 发送地址                            | string            |                                                              |
| smartHost    | SMTP server地址                     | HostPort          | HostPort包含host（string）以及port（int）两个字段            |
| authUsername | CRAM-MD5, LOGIN 和PLAIN认证的用户名 | string            | omitempty                                                    |
| authPassword | CRAM-MD5, LOGIN 和PLAIN认证的密码   | Credential        | Credential 可以选择value（string）以及valueFrom(ValueSource)两种中的一种。ValueSource类型含有secretKeyRef字段，该结构包含namespace（string），name（string），key（string）    omitempty |
| requireTLS   | 默认SMTP TLS要求。                  | bool              | 是否开启  omitempty                                          |

##### slack字段   类型：slackConfig  

| 字段             | 说明          | 类型              | 备注      |
| ---------------- | ------------- | ----------------- | --------- |
| labels           | slack的labels | map[string]string | omitempty |
| slackTokenSecret |               | Credential        |           |

##### webhook字段   类型：webhookConfig

| 字段   | 说明            | 类型              | 备注      |
| ------ | --------------- | ----------------- | --------- |
| labels | webhook的labels | map[string]string | omitempty |

##### wechat字段   类型：wechatConfig

| 字段             | 说明                                               | 类型              | 备注      |
| ---------------- | -------------------------------------------------- | ----------------- | --------- |
| labels           | wechat的labels                                     | map[string]string | omitempty |
| wechatApiUrl     | WeChat API URL.                                    | string            | omitempty |
| wechatApiCorpId  | The corp id for authentication.                    | string            |           |
| WechatApiAgentId | 发送消息的应用程序id                               | string            |           |
| wechatApiSecret  | The API key to use when talking to the WeChat API. | Credential        |           |

##### sms字段   类型：smsConfig

| 字段            | 说明                                                       | 类型      | 备注      |
| --------------- | ---------------------------------------------------------- | --------- | --------- |
| defaultProvider | 默认 sms provider, 可选, use the first provider if not set | string    | omitempty |
| providers       | All sms providers                                          | Providers |           |

###### Providers 

| 字段    | 说明 | 类型       | 备注      |
| ------- | ---- | ---------- | --------- |
| aliyun  |      | AliyunSMS  | omitempty |
| tencent |      | TencentSMS | omitempty |
| huawei  |      | HuaweiSMS  | omitempty |

  AliyunSMS  

| 字段            | 说明 | 类型       | 备注      |
| --------------- | ---- | ---------- | --------- |
| signName        |      | string     |           |
| templateCode    |      | string     | omitempty |
| accessKeyId     |      | Credential |           |
| accessKeySecret |      | Credential |           |

TencentSMS

| 字段        | 说明 | 类型       | 备注 |
| ----------- | ---- | ---------- | ---- |
| sign        |      | string     |      |
| templateID  |      | string     |      |
| smsSdkAppid |      | string     |      |
| secretId    |      | Credential |      |
| secretKey   |      | Credential |      |

HuaweiSMS

| 字段       | 说明 | 类型       | 备注      |
| ---------- | ---- | ---------- | --------- |
| url        |      | string     | omitempty |
| signature  |      | string     |           |
| templateId |      | string     |           |
| sender     |      | string     |           |
| appSecret  |      | Credential |           |
| appKey     |      | Credential |           |

##### pushover字段   类型：pushoverConfig

| 字段                | 说明             | 类型              | 备注      |
| ------------------- | ---------------- | ----------------- | --------- |
| labels              | pushover的labels | map[string]string | omitempty |
| pushoverTokenSecret |                  | Credential        |           |

### receiver

格式

```go
"receiver":{
    "apiVersion":"notification.kubesphere.io/v2beta2",
    "kind":"Receiver",
    "metadata":{
      "name":"test-user-receiver",
      "labels":{
        "app":"notification-manager",
        "type":"tenant",
        "user":"test-user"
      }
    },
    "spec":{
      "dingtalk"
      "email"
      "slack"
      "webhook"
      "wechat"
      "sms"
      "pushover"
    }
  }


```

以email为例

```
"email":{
        "emailConfigSelector":{
          "matchLabels":{
            "type":"tenant",
            "user":"test-user"
          }
        },
        "to":[
          "xxx"
        ]
      }
```

| 字段       | 说明           | 类型         | 备注                                                         |
| ---------- | -------------- | ------------ | ------------------------------------------------------------ |
| apiVersion |                |              | notification.kubesphere.io/v2beta2                           |
| kind       |                |              | Receiver                                                     |
| metadata   | Receiver元数据 | ObjectMeta   | 包含name、labels等数据 。meta.labels.type传入租户级别（包含tenant以及global两种）以及 meta.labels.user传入user名 |
| spec       |                | ReceiverSpec | 包含七种，dingtalk，email,slack，webhook，wechat，sms，pushover |

##### dingtalk字段   类型：DingTalkReceiver 

| 字段                   | 说明                                                         | 类型                 | 备注      |
| ---------------------- | ------------------------------------------------------------ | -------------------- | --------- |
| enabled                | 是否需要开启                                                 | bool                 | omitempty |
| dingtalkConfigSelector | DingTalkConfig to be selected for this receiver              | metav1.LabelSelector | omitempty |
| alertSelector          | Selector to filter alerts.                                   | metav1.LabelSelector | omitempty |
| chatbot                |                                                              | DingTalkChatBot      | omitempty |
| conversation           | 信息将发送到的会话                                           | DingTalkConversation | omitempty |
| template               | 生成DingTalk消息的模板名称。如果全局模板没有被设置，它将使用default。 | string               | omitempty |
| titleTemplate          | 要生成markdown标题的模板的名称                               | string               | omitempty |
| tmplType               | 模板种类: text or markdown                                   | string               | omitempty |

DingTalkChatBot

| 字段      | 说明                                                         | 类型       | 备注      |
| --------- | ------------------------------------------------------------ | ---------- | --------- |
| webhook   | 消息将发送到chatbot的webhook。                               | Credential |           |
| keywords  | 自定义聊天机器人关键字                                       | string[]   | omitempty |
| secret    | Secret of ChatBot, you can get it after enabled Additional Signature of ChatBot. | Credential | omitempty |
| atMobiles | The phone numbers of the users which will be @.              | string[]   | omitempty |
| atUsers   | The users who will be @.                                     | string[]   | omitempty |
| atAll     | Whether @everyone.                                           | bool       | omitempty |

DingTalkConversation

| 字段    | 说明   | 类型     | 备注 |
| ------- | ------ | -------- | ---- |
| chatids | 会话id | string[] |      |

##### email字段   类型：EmailReceiver 

| 字段                | 说明                                                         | 类型                 | 备注      |
| ------------------- | ------------------------------------------------------------ | -------------------- | --------- |
| enabled             | 是否需要开启                                                 | bool                 | omitempty |
| to                  | Receiver邮件地址                                             | string[]             |           |
| emailConfigSelector | EmailConfig to be selected for this receiver                 | metav1.LabelSelector | omitempty |
| alertSelector       | Selector to filter alerts                                    | metav1.LabelSelector | omitempty |
| template            | 生成消息的模板名称。如果全局模板没有被设置，它将使用default。 | string               | omitempty |
| subjectTemplate     |                                                              | string               | omitempty |
| tmplType            | 模板种类: text or html默认html                               | string               | omitempty |

##### slack字段   类型：SlackReceiver 

| 字段                | 说明                                          | 类型                 | 备注      |
| ------------------- | --------------------------------------------- | -------------------- | --------- |
| enabled             | 是否需要开启                                  | bool                 | omitempty |
| slackConfigSelector | slackConfig to be selected for this receiver  | metav1.LabelSelector | omitempty |
| alertSelector       | Selector to filter alerts                     | metav1.LabelSelector | omitempty |
| channels            | The channel or user to send notifications to. | string[]             |           |
| template            |                                               | string               | omitempty |

##### webhook字段   类型：WebhookReceiver 

| 字段                  | 说明                                                         | 类型                 | 备注      |
| --------------------- | ------------------------------------------------------------ | -------------------- | --------- |
| enabled               | 是否需要开启                                                 | bool                 | omitempty |
| webhookConfigSelector | webhookConfig to be selected for this receiver               | metav1.LabelSelector | omitempty |
| alertSelector         | Selector to filter alerts                                    | metav1.LabelSelector | omitempty |
| url                   | url '以标准的url形式(' scheme://host:port/path ')给出了webhook的位置。必须指定' url '或' service '中的一个。 | string               | omitempty |
| service               |                                                              | ServiceReference     | omitempty |
| httpConfig            |                                                              | HTTPClientConfig     | omitempty |
| template              | 生成消息的模板名称。如果全局模板没有被设置，它将使用default。 | string               | omitempty |

ServiceReference

| 字段      | 说明                                                         | 类型   | 备注      |
| --------- | ------------------------------------------------------------ | ------ | --------- |
| namespace |                                                              | string |           |
| name      |                                                              | string |           |
| path      | ' path '是一个可选的URL路径，它将在任何请求中被发送到这个服务 | string | omitempty |
| port      |                                                              | int    | omitempty |
| scheme    |                                                              | string | omitempty |

HTTPClientConfig

| 字段        | 说明                                                       | 类型       | 备注                                                         |
| ----------- | ---------------------------------------------------------- | ---------- | ------------------------------------------------------------ |
| basicAuth   | The HTTP basic authentication credentials for the targets. | BasicAuth  | omitempty包含username（string）以及password（Credential）两个字段 |
| bearerToken | The bearer token for the targets.                          | Credential | omitempty                                                    |
| proxyUrl    | HTTP proxy server to use to connect to the targets.        | string     | omitempty                                                    |
| tlsConfig   |                                                            | int        | omitempty                                                    |

##### wechat字段   类型：WechatReceiver

| 字段                 | 说明                                                         | 类型                 | 备注      |
| -------------------- | ------------------------------------------------------------ | -------------------- | --------- |
| enabled              | 是否需要开启                                                 | bool                 | omitempty |
| wechatConfigSelector | WechatConfig to be selected for this receiver                | metav1.LabelSelector | omitempty |
| alertSelector        | Selector to filter alerts                                    | metav1.LabelSelector | omitempty |
| toUser               |                                                              | string[]             | omitempty |
| toParty              |                                                              | string[]             | omitempty |
| toTag                |                                                              | string[]             | omitempty |
| template             | 生成消息的模板名称。如果全局模板没有被设置，它将使用default。 | string               | omitempty |
| tmplType             | 模板种类: text or markdown默认text                           | string               | omitempty |

##### sms字段   类型：SmsReceiver

| 字段              | 说明                                                         | 类型                 | 备注      |
| ----------------- | ------------------------------------------------------------ | -------------------- | --------- |
| enabled           | 是否需要开启                                                 | bool                 | omitempty |
| smsConfigSelector | SmsConfig to be selected for this receiver                   | metav1.LabelSelector | omitempty |
| alertSelector     | Selector to filter alerts                                    | metav1.LabelSelector | omitempty |
| phoneNumbers      |                                                              | string[]             | omitempty |
| template          | 生成消息的模板名称。如果全局模板没有被设置，它将使用default。 | string               | omitempty |

##### pushover字段   类型：PushoverReceiver

| 字段                   | 说明                                                         | 类型                  | 备注      |
| ---------------------- | ------------------------------------------------------------ | --------------------- | --------- |
| enabled                | 是否需要开启                                                 | bool                  | omitempty |
| pushoverConfigSelector | SmsConfig to be selected for this receiver                   | metav1.LabelSelector  | omitempty |
| alertSelector          | Selector to filter alerts                                    | metav1.LabelSelector  | omitempty |
| profiles               | 用户配置文件                                                 | PushoverUserProfile[] |           |
| template               | 生成消息的模板名称。如果全局模板没有被设置，它将使用default。 | string                | omitempty |

PushoverUserProfile[]

| 字段    | 说明                                                         | 类型     | 备注      |
| ------- | ------------------------------------------------------------ | -------- | --------- |
| userKey | UserKey is the user (Pushover User Key) to send notifications to. | string   |           |
| devices | Devices refers to device name to send the message directly to that device, rather than all of the user's devices | string[] | omitempty |
| title   | Title refers to message's title, otherwise your app's name is used. | string   | omitempty |
| sound   |                                                              | string   | omitempty |

返回参数

| 字段    | 值          | 备注 |
| ------- | ----------- | ---- |
| Status  | 200/400/403 |      |
| Message | string      |      |

返回结果

> {
>
>   "Status": 200,
>
>   "Message": "Verify successfully"
>
> }
